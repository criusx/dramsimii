<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <title>Real-time Position Monitoring</title>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    <style type="text/css">
      v\:* {
          behavior:url(#default#VML);
      }</style>
    <link href="css/format.css" media="screen" rel="stylesheet" type="text/css" />

    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAl6hrDb49xWS3d0WtSqQLMxSY_R9GqXOP67i2Qu6GZCnZlQkzHxSvai30snUGXYRnL0zku--QNC7hCQ" type="text/javascript" ></script>

    <script src="GetDatesWSSoapHttpPort?GetDatesWSSoapHttpPortstub.js" type="text/javascript" ></script>

    <meta
      content="cell phones, RFID, reader, disposable sensors, diagnostics, wireless skin patch, consumer, sensor, sensor networks, passive, temperature, homeland security, immunoassay, radiation"
      name="keywords" />
    <meta content="Empowering Consumers With Vital Information" name="description" />

    <script type="text/javascript">
            // globals
            var lastLookup = new Date(0);
            var map;
            
            function init()
            {
                GetDatesWSSoapHttpPort_getUniqueUIDsAsync(addUIDs);
                if (GBrowserIsCompatible())
                {
                    map = new GMap2(document.getElementById("map"));
                    map.addControl(new GLargeMapControl());
                    map.addControl(new GMapTypeControl());
                    map.addControl(new GOverviewMapControl());
                    map.enableScrollWheelZoom();
                    map.setCenter(new GLatLng(38.903708, - 77.066474), 13);
                }
                setInterval("updateRoute()", 30000);
            }
            
            function addUIDs(reqObject)
            {
                var divHandle = document.getElementById("id");
                while (divHandle.hasChildNodes())
                { 
                  divHandle.removeChild(divHandle.firstChild);
                 }
                
                if (divHandle)
                {
                    for (x in reqObject)
                    {
                        var currentItem = document.createElement("option");
                        currentItem.setAttribute("value", reqObject[x]);
                        currentItem.appendChild(document.createTextNode(reqObject[x]));
                        divHandle.appendChild(currentItem);
                    }
                }
                updateRoute();
            }
            
            function updateRoute()
            {
                var selected = document.getElementById("id") .options[document.getElementById("id") .selectedIndex].value;
                GetDatesWSSoapHttpPort_getRouteAsync(selected, lastLookup.getTime(), addResults);
            }
            
            // Creates a marker at the given point with the given number label
            function createMarker(point, desc)
            {
                var marker = new GMarker(point);
                GEvent.addListener(marker, "click", function ()
                {
                    marker.openInfoWindowHtml(desc);
                });
                return marker;
            }
            
            var currentLat;
            var currentLong;
            var polylineArray = [];
            
            function addResults(reqObject)
            {
                if (reqObject.length == 0)
                return;
                for (x in reqObject)
                {
                    switch (x % 3)
                    {
                        case 0:
                        currentLat = parseFloat(reqObject[x]);
                        break;
                        case 1:
                        currentLong = parseFloat(reqObject[x]);
                        polylineArray.push(new GLatLng(currentLat, currentLong));
                        break;
                        case 2:
                        var comparison = new Date(Date.parse(reqObject[x]));
                        if (comparison > lastLookup)
                        lastLookup = comparison;
                        break;
                    }
                }
                
                map.clearOverlays();
                map.addOverlay(new GPolyline(polylineArray));
                map.addOverlay(createMarker(new GLatLng(currentLat, parseFloat(reqObject[reqObject.length - 2])),
                currentLat + "," + parseFloat(reqObject[reqObject.length - 2]) + "<br />" +
                reqObject[reqObject.length - 1]));
            map.panTo(new GLatLng(currentLat, parseFloat(reqObject[reqObject.length - 2])), 13);
        }
        
        function recenter()
        {
            map.panTo(new GLatLng(currentLat, parseFloat(currentLong)), 13);
        }
        /*var divHandle = document.getElementById("theTableBody");
        
        var currentRow = document.createElement("tr");
        //currentRow.style.display = "table-row";
        
        if (rows == 0)
        currentRow.className = "odd";
        
        if (divHandle)
        {
        
        for (x in reqObject)
        {
        var currentCell = document.createElement("td");
        //currentCell.style.display = "table-cell";
        
        // grab the time
        if (x % 5 == 2)
        {
        var comparison = new Date(Date.parse(reqObject[x]));
        if (comparison > lastLookup)
        lastLookup = comparison;
        currentText = document.createTextNode(comparison.toGMTString());
        }
        else
        {
        currentText = document.createTextNode(reqObject[x]);
        }
        currentCell.appendChild(currentText);
        
        currentRow.appendChild(currentCell);
        
        if (x % 5 == 4)
        {
        divHandle.insertBefore(currentRow, divHandle.firstChild);
        currentRow = document.createElement("tr");
        //currentRow.style.display = "table-row";
        if (rows == 0)
        {
        rows = 1;
        currentRow.className = "odd";
        }
        else
        {
        rows = 0;
        }
        }
        
        }
        }
        divHandle = document.getElementById("updatedTime");
        if (divHandle)
        {
        var presentTime = new Date();
        
        divHandle.firstChild.nodeValue = presentTime.toUTCString();
        }*/</script>

  </head>
  <body onload="init()" onunload="GUnload()">
    <div id="content-container" class="realtimeTracking">
      <div id="logo">
        <img alt="Gentag" id="main-logo" src="http://www.gentag.com/images/Gentag-logo.png" />
        <br />
      </div>
      <fieldset id="idSelector">
        <legend>Choose the phone UID</legend>
        <input id="centerOnCurrent" onclick="recenter();" type="button"
          value="Center on Current Location" />
        <input onclick="update();" type="button" value="Refresh Now" />
        <select id="id" name="selectIDList" onchange="updateRoute()">
          <option />
        </select>
      </fieldset>
      <div> Last updated at: <div id="updatedTime"> </div>
      </div>
      <div id="map"> </div>
    </div>
  </body>
</html>
