<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Transaction Monitoring</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
    <link href="css/format.css" rel="stylesheet" type="text/css" media="screen"></link>
    <script type="text/javascript"
            src="AuthenticationWebServiceSoapHttpPort?AuthenticationWebServiceSoapHttpPortstub.js"></script>
    <meta name="keywords"
          content="cell phones, RFID, reader, disposable sensors, diagnostics, wireless skin patch, consumer, sensor, sensor networks, passive, temperature, homeland security, immunoassay, radiation"></meta>
    <meta name="description"
          content="Empowering Consumers With Vital Information"></meta>
    <script type="text/javascript">
    // globals
    var lastLookup = new Date(0);
    var rows = 0;

    function init()
    {
    update();
    setInterval("update()", 30000);
    }

    function update()
    {
    //alert(lastLookup.toGMTString());
    AuthenticationWebServiceSoapHttpPort_getSinceAsync(lastLookup.getTime(), addResults);    
    }

    function addResults(reqObject)
    {
    var divHandle = document.getElementById("theTableBody");

    var currentRow = document.createElement("tr");
    //currentRow.style.display = "table-row";
    
    if (rows == 0)
      currentRow.className = "odd";

    if (divHandle)
    {      
      for (x in reqObject)
      {
        var currentCell = document.createElement("td");
        //currentCell.style.display = "table-cell";
        
        // grab the time
        if (x % 5 == 2)
        {          
          var comparison = new Date(Date.parse(reqObject[x]));          
          if (comparison > lastLookup)
            lastLookup = comparison;
          currentText = document.createTextNode(comparison.toGMTString());
        }
        else
        {
          currentText = document.createTextNode(reqObject[x]);
        }
        currentCell.appendChild(currentText);
        
        currentRow.appendChild(currentCell);

        if (x % 5 == 4)
        { 
          if (divHandle.firstChild)
            divHandle.insertBefore(currentRow, divHandle.firstChild);
          else
            divHandle.appendChild(currentRow);
            
          currentRow = document.createElement("tr");
          
          if (rows == 0)
          {
            rows = 1;
            currentRow.className = "odd";
          }
          else
          {
            rows = 0;            
          }
        }
        
      }
    }
    divHandle = document.getElementById("updatedTime");
    if (divHandle)
    {
      var presentTime = new Date();
      
      divHandle.nodeValue = presentTime.toUTCString();
    }
    }
  </script>
  </head>
  <body onload="init()"><div id="content-container" class="wineLookup2">
      <div id="logo">
        <img src="http://www.gentag.com/images/Gentag-logo.png" alt="Gentag"
             id="main-logo"></img>
         
        <br></br>
      </div>
       
      <form name="form1" action="">
        <input type="button" value="Refresh Now" onclick="update();"/>
      </form>
      <div>Last updated at: <div id="updatedTime"> </div></div>
       
      <table id="theTable" style="display:table">
        <caption>All scans so far</caption>
        <thead>
          <tr>
            <th>Scanner UID</th>
            <th>Item's RFID #</th>
            <th>Time scan received</th>
            <th>Latitude</th>
            <th>Longitude</th>
          </tr>
        </thead>
        <tbody id="theTableBody"></tbody>
      </table>
    </div></body>
</html>
